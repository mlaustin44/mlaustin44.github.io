(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{396:function(e,t,a){"use strict";a.r(t);var s=a(10),o=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"what-this-is-about"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-this-is-about"}},[e._v("#")]),e._v(" What this is about")]),e._v(" "),a("p",[e._v("How to configure a Dell PowerConnect 5324 (and, presumably, a bunch of similar Dell switches) to be effectively use VLANs to segment a home network.")]),e._v(" "),a("h2",{attrs:{id:"background"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#background"}},[e._v("#")]),e._v(" Background")]),e._v(" "),a("h3",{attrs:{id:"why-i-own-it"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#why-i-own-it"}},[e._v("#")]),e._v(" Why I own it")]),e._v(" "),a("p",[e._v("I purchased a used Dell Powerconnect 5324 a few years ago as part of a larger home network upgrade triggered because the early 1900's house we had purchased was built with a combination of layout and materials which would not allow a single WAP to cover the entirety of our living space.  When I started pricing out consumer grade mesh WiFi systems, I quickly realized that I could build a complete system out of true, commerical grade components for not much more...so that's what I did.  The PowerConnect 5324 has some "),a("a",{attrs:{href:"https://www.dell.com/downloads/global/products/pwcnt/en/pwcnt_5324_brief.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("pretty impressive specs"),a("OutboundLink")],1),e._v(" and the fact that I could get a enterprise gigabit switch, with SFP ports and full L2 management capabilities for less than 1/3 of the price of small business or comsumer units was very attractive.")]),e._v(" "),a("h3",{attrs:{id:"am-i-happy-with-it"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#am-i-happy-with-it"}},[e._v("#")]),e._v(" Am I happy with it?")]),e._v(" "),a("p",[e._v("Eh.  Kinda.  It's rack mounted enterprise hardware - the interface is beyond confusing, the documentation manages to be comprehensive while still being very unhelpful, it has the sound output of a small jet engine, and it consumes something like 50w at idle which works out to about $5/mo to run at our electricity rates.  It's a very solid piece of hardware, but in retrospect it's poorly specified to my application.  If anyone is debating buying one, I'd suggest that you don't discount the sound level, the TCO with electricity, and the overall convuluted complexity of configuring it.")]),e._v(" "),a("h3",{attrs:{id:"why-do-i-want-vlans"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#why-do-i-want-vlans"}},[e._v("#")]),e._v(" Why do I want VLANs?")]),e._v(" "),a("p",[e._v("Well, to segregate devices you have with sensitive information (phones, laptops, etc) from devices you don't trust.  In my use case this means IoT devices - like the Thermostat from a company with more expertise building heaters than connected devices, or the Smart TV, or guest's laptops, etc.")]),e._v(" "),a("h2",{attrs:{id:"vlan-basics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vlan-basics"}},[e._v("#")]),e._v(" VLAN basics")]),e._v(" "),a("p",[e._v("A VLAN is 'a broadcast domain in a Layer 2 network' - "),a("a",{attrs:{href:"https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst4500/12-2/25ew/configuration/guide/conf/vlans.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("thanks Cisco"),a("OutboundLink")],1),e._v(".  We can break that down to be a bit more helpful.")]),e._v(" "),a("p",[e._v("Layer 2 here refers to the "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/OSI_model",target:"_blank",rel:"noopener noreferrer"}},[e._v("OSI Model"),a("OutboundLink")],1),e._v(" and is the layer at which switches operate.  Layer 2 is where individual datagrams are sent to specific devices (sort of a packet-to-MAC-address delivery system).  The broadcast domain is just the set of devices you would reach if you sent a broadcast message on a network.")]),e._v(" "),a("p",[e._v("So, VLANs divide one physical network into multiple virtual networks by exercising control over which devices certain packets will be delivered to.  You can create VLANs in a number of ways, including the type of traffic, which port on a switch traffic comes from, etc.")]),e._v(" "),a("p",[e._v("There were historically a number of propietary protocols for VLANs on switches, but today everything has converged on 802.1q as a shared standard.  802.1q uses a tag which is inserted into the packet header and defines which VLAN the packet is a member of.")]),e._v(" "),a("h2",{attrs:{id:"my-setup-and-requirements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#my-setup-and-requirements"}},[e._v("#")]),e._v(" My Setup and Requirements")]),e._v(" "),a("p",[e._v("My home network setup uses Unifi wireless APs to provide Wifi.  These APs are all connected individually to my the Powerconnect switch.  I use a Unifi Security Gateway as a router, which has the LAN port plugged into the switch.  There is a single port on the switch which is used to connected "),a("em",[e._v("wired")]),e._v(" IoT devices (which are fortunately all clustered in my living room and connected to thier own 5-port switch - this is my Smarthings hub, Roku, Playstation, etc).")]),e._v(" "),a("p",[e._v("My Unifi Access Points are configured with two SSIDs, one for normal use and one for IoT devices.  The normal SSID is the native VLAN (no tag) and the IoT deviecs are on VLAN 30.  I followed "),a("a",{attrs:{href:"https://vninja.net/2019/08/08/creating-isolated-networks-ubiquiti/",target:"_blank",rel:"noopener noreferrer"}},[e._v("this guide"),a("OutboundLink")],1),e._v(" to configure my Unifi setup for multiple networks.")]),e._v(" "),a("p",[e._v("I (generally) followed this "),a("a",{attrs:{href:"https://www.stevejenkins.com/blog/2011/05/dell-powerconnect-5324-setup-tasks/",target:"_blank",rel:"noopener noreferrer"}},[e._v("very helpful guide"),a("OutboundLink")],1),e._v(" to get my PowerConnect switch set up initially.  My network gear is located in an unpleasant corner of my basement, so being able to interact over SSH and a web UI was basically a necesity.")]),e._v(" "),a("h2",{attrs:{id:"configuring-the-dell-powerconnect"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuring-the-dell-powerconnect"}},[e._v("#")]),e._v(" Configuring the Dell Powerconnect")]),e._v(" "),a("p",[e._v("After I set everything up on my Unifi system, the normal SSID was working fine but no devices on the IoT SSID were getting IPs assigned by DHCP.  Something was clearly wrong, and it took me a few moments to realize my switch wasn't passing the traffic on VLAN 30 correctly.")]),e._v(" "),a("p",[e._v("There's 5 basic steps here:")]),e._v(" "),a("ol",[a("li",[e._v("Add the new VLAN to the switch")]),e._v(" "),a("li",[e._v("Configure the new VLAN")]),e._v(" "),a("li",[e._v("Configure the physical IoT port (to add VLAN tags to all traffic going through it)")]),e._v(" "),a("li",[e._v("Configure the WAP and router ports (to pass through tagged traffic)")]),e._v(" "),a("li",[e._v("Save the config")])]),e._v(" "),a("p",[e._v("I'm going to use the command line for everything here because the web interface is functionally unusable for me.  I believe that you can do all of this using the web interface if you wish")]),e._v(" "),a("h3",{attrs:{id:"connecting-and-managing-the-switch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#connecting-and-managing-the-switch"}},[e._v("#")]),e._v(" Connecting and managing the switch")]),e._v(" "),a("p",[e._v("These are more notes to go with Steve Jenkin's extremely helpful guide linked above.")]),e._v(" "),a("ul",[a("li",[e._v("If you configured HTTPS per Steve's guide, you'll need to connect using 'https://' in the URL.  This feels like a no brainer, but the switch won't automatically reroute your request or give an error, it will just ignore HTTP traffic.")]),e._v(" "),a("li",[e._v("If you use SSH from a modern computer you have to tell it to not worry so much about the switch using crypto which is now considered insecure.  This is what I did on a Macbook running Catalina, you might need slightly different steps on other platforms:\n"),a("ul",[a("li",[e._v("To enable older ciphers, you'll need to uncomment this line in /etc/ssh/ssh_config:")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc,aes256-cbc\n")])])]),a("ul",[a("li",[e._v("And to actually connect, you'll need this SSH command to allow the use of old key sharing algorithms:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" -oKexAlgorithms"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("+diffie-hellman-group1-sha1 XXXXXXXX@192.168.XXX.XXX\n")])])])])]),e._v(" "),a("h3",{attrs:{id:"adding-the-new-vlan-to-the-switch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-the-new-vlan-to-the-switch"}},[e._v("#")]),e._v(" Adding the new VLAN to the switch")]),e._v(" "),a("p",[e._v("This one is pretty simple.  Enter config mode with")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("configure\n")])])]),a("p",[e._v("Next, access the VLAN database feature")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("vlan database\n")])])]),a("p",[e._v("Add the new VLAN (in my case, 30)")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("vlan 30\n")])])]),a("p",[e._v("To exit modes the command is 'exit'.  Exit twice to get back to the main mode and then list the vlans with")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("show vlan\n")])])]),a("p",[e._v("If you configured the VLAN correctly you should see it here.  Note that no ports will be configured yet, but this is what I see on a fully configured setup:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("console# show vlan\n\nVlan       Name                   Ports                Type     Authorization\n---- ----------------- --------------------------- ------------ -------------\n 1           1            g(1-13,15-24),ch(1-8)       other       Required\n 30       iotnew               g(1,3-5,14)          permanent     Required\n")])])]),a("h3",{attrs:{id:"configure-the-new-vlan"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-new-vlan"}},[e._v("#")]),e._v(" Configure the new VLAN")]),e._v(" "),a("p",[e._v("Make sure you're in configure mode and then configure the new vlan")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("interface vlan 30\n")])])]),a("p",[e._v("Add the IP you want the switch to use on the VLAN.  In my case, VLAN 30 corresponds to 192.168.30.0/24, with the gateway at 192.168.30.1.  I chose the have the switch at 192.168.30.251 (my DHCP is configured to stop at .250).")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ip address 192.168.30.251 255.255.255.0\n")])])]),a("p",[e._v("Exit the interface configuration mode and then add an additional default gateway to your switch config (the switch will know which interface it goes to based on the IP - which is why you add in the main config mode rather than in VLAN config mode)")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ip default-gateway 192.168.30.1\n")])])]),a("p",[e._v("Now the VLAN is configured and ready to have some ports assigned to it.")]),e._v(" "),a("h3",{attrs:{id:"configure-the-physical-iot-port"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-physical-iot-port"}},[e._v("#")]),e._v(" Configure the physical IoT port")]),e._v(" "),a("p",[e._v("My use case requires a single physical port (with multiple downstream devices behind a switch) to all be on a single VLAN.  The traffic will come in untagged and ignorant of VLANs, so we will configure that port (#14 in my case) to tag all traffic passing through it as being on a VLAN")]),e._v(" "),a("p",[e._v("From configuration mode, enter configuration for port 14")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("interface ethernet g14\n")])])]),a("p",[e._v("A quick aside here - there are 3 modes for ports on the Powerconnect and the explanations in the manual are totally unhelpful.  I'll try to give some better ones.  Remember that the switch can forcibly add or remove 802.1q tags to traffic passing through its ports based on configuration.")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("General")]),e._v(" - don't care about traffic passing through regardless of whether or not it has a tag.  "),a("em",[e._v("However")]),e._v(" - if it does have a tag, it has to be for a VLAN this port is allowed to use or it will drop the traffic.  This is what we want for the WAPs, since traffic on the IoT VLAN will be tagged and traffic on the general VLAN will be untagged.")]),e._v(" "),a("li",[a("strong",[e._v("Access")]),e._v(" - all traffic coming in must be untagged.  The switch will then tag it with a single VLAN.  This is the use case for our IoT devices - they have no idea about VLANs and we want to just assign them to one.")]),e._v(" "),a("li",[a("strong",[e._v("Trunk")]),e._v(" - all traffic coming through must belong to a VLAN which has ports assigned in the router.  This is what you'd use to connect multiple switches together.")])]),e._v(" "),a("p",[e._v("Back to the main event: configuring port 14 to be in access mode assigned to VLAN 30")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("switchport access vlan 30\n")])])]),a("h3",{attrs:{id:"configure-the-wap-and-router-ports"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-wap-and-router-ports"}},[e._v("#")]),e._v(" Configure the WAP and Router ports")]),e._v(" "),a("p",[e._v("These are configured the same way - we want them to pass through both tagged and untagged traffic.  The PowerConnect will pass through untagged traffic without caring about it, but it needs to have VLANs specifically enabled to pass through tagged traffic.  This was the biggest gotcha for me - I expected general mode to pass through whatever traffic, but it needs to be specifically configured to allow VLANs, which only took me about 2 hours to figure out.")]),e._v(" "),a("p",[e._v("You can do this individually or you can use the 'range' function to modify a batch of ports at once")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("interface range ethernet g(1,3-5)\nswitchport general allowed vlan add 30\n")])])]),a("p",[e._v("The second line means set to general mode, then for the allowed vlan list add vlan 30.")]),e._v(" "),a("h3",{attrs:{id:"save-the-config"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#save-the-config"}},[e._v("#")]),e._v(" Save the config")]),e._v(" "),a("p",[e._v("This is probably the biggest f*** you from these switches - they have two configurations (a running config and a startup config).  The running config, which is what's actually controlling the switch, is stored in RAM, so everytime the switch boots it copies the startup config to the running config.  Everything we've done has modified the running config, but if you powered cycled the router it would all disappear.")]),e._v(" "),a("p",[e._v("There's 2 things things we can do - both from the main mode (not config mode):")]),e._v(" "),a("p",[e._v("First, copy the current running config into the startup config:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("copy running-config startup-config\n")])])]),a("p",[e._v("And second, have the switch output the entire running config to the console so you can copy it somewhere.  There's a whole fancy thing you can do with FTP to get configs on and off the device, but for the amount of configuring I do (about 1 configuration change every 18 months) it would take me longer to remember how to do that than to just copy paste from the terminal into a private github gist.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("show running-config\n")])])])])}),[],!1,null,null,null);t.default=o.exports}}]);